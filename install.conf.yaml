- clean: ['~']

- link:
    ~/.bash_profile:
        path: bash_profile
        force: true
    ~/.bashrc:
        path: bashrc
        force: true
    ~/.gitconfig:
        path: gitconfig
        force: true
    ~/.vimrc:
        path: vimrc
        force: true
    ~/.zshrc:
        path: zshrc
        force: true
    ~/.config/nvim/init.vim:
        path: init.vim
        create: true
        force: true
    ~/.config/Code/User/keybindings.json:
        path: .vscode/keybindings.json
        create: true
        force: true
    ~/.config/Code/User/settings.json:
        path: .vscode/settings.json
        create: true
        force: true
    ~/.config/terminator/config:
        path: .terminator/config
        create: true
        force: true
    ~/.config/ghostty/config:
        path: .config/ghostty/config
        create: true
        force: true

    # Claude Code configuration
    ~/.claude/settings.json:
        path: .claude/settings.json
        create: true
        force: true
    ~/.claude/CLAUDE.md:
        path: .claude/CLAUDE.md
        create: true
        force: true
    ~/.claude/hooks:
        path: .claude/hooks
        create: true
        force: true
    ~/.claude/commands:
        path: .claude/commands
        create: true
        force: true
    ~/.claude/skills:
        path: .claude/skills
        create: true
        force: true
    ~/.claude/thoughts:
        path: .claude/thoughts
        create: true
        force: true

    # MCP configuration
    ~/.config/Code/User/mcp.json:
        path: .config/Code/User/mcp.json
        create: true
        force: true

    # Zsh theme (customized)
    ~/.oh-my-zsh/themes/igorsilva.zsh-theme:
        path: .config/zsh/themes/igorsilva.zsh-theme
        force: true

- shell:
    -
        command: |
            if ! grep -qE 'Ubuntu|Debian' /etc/os-release 2>/dev/null; then
                echo "Warning: This install script is designed for Ubuntu/Debian. Some commands may fail."
            fi
        description: Checking OS compatibility...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: command -v vim >/dev/null 2>&1 || sudo apt-get install -y vim
        description: Installing vim...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: '[ -f ~/.vim/autoload/plug.vim ] || curl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'
        description: Installing vim-plug...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: vim +PlugInstall +qall
        description: Installing vim plugins...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: command -v zsh >/dev/null 2>&1 || sudo apt-get install -y zsh
        description: Installing zsh...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: command -v direnv >/dev/null 2>&1 || sudo apt-get install -y direnv
        description: Installing direnv...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: command -v nix >/dev/null 2>&1 || sh <(curl -L https://nixos.org/nix/install) --no-daemon
        description: Installing Nix (single-user mode)...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: command -v bison >/dev/null 2>&1 || sudo apt-get install -y bison
        description: Installing bison (required for gvm)...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: sudo apt-get install -y make build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev curl git libncursesw5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev libffi-dev liblzma-dev
        description: Installing pyenv build dependencies...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: '[ -d ~/.oh-my-zsh ] || sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended'
        description: Installing oh-my-zsh...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: '[ -d ~/.fzf ] || (git clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf && ~/.fzf/install --all)'
        description: Installing fzf...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: '[ -d ~/.gvm ] || zsh < <(curl -s -S -L https://raw.githubusercontent.com/moovweb/gvm/master/binscripts/gvm-installer)'
        description: Installing gvm...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: command -v fnm >/dev/null 2>&1 || curl -fsSL https://fnm.vercel.app/install | bash
        description: Installing fnm...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: '[ -d ~/.pyenv ] || curl -fsSL https://pyenv.run | bash'
        description: Installing pyenv...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: '[ -d ~/.pyenv/plugins/pyenv-virtualenv ] || git clone https://github.com/pyenv/pyenv-virtualenv.git ~/.pyenv/plugins/pyenv-virtualenv'
        description: Installing pyenv-virtualenv...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: command -v ghostty >/dev/null 2>&1 || /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/mkasberg/ghostty-ubuntu/HEAD/install.sh)"
        description: Installing Ghostty...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: command -v terminator >/dev/null 2>&1 || sudo apt-get install -y terminator
        description: Installing Terminator...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: command -v gnome-screenshot >/dev/null 2>&1 || sudo apt-get install -y gnome-screenshot
        description: Installing gnome-screenshot...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: '[ -x ~/.local/bin/satty ] || (curl -sL https://github.com/Satty-org/Satty/releases/download/v0.20.0/satty-x86_64-unknown-linux-gnu.tar.gz | tar xz -C ~/.local/bin --strip-components=0 ./satty && chmod +x ~/.local/bin/satty)'
        description: Installing Satty (screenshot annotation)...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: command -v flatpak >/dev/null 2>&1 || sudo apt-get install -y flatpak
        description: Installing Flatpak...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: flatpak remote-list | grep -q flathub || flatpak remote-add --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo
        description: Adding Flathub repository...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: command -v code >/dev/null 2>&1 || (curl -fsSL -o /tmp/vscode.deb "https://code.visualstudio.com/sha/download?build=stable&os=linux-deb-x64" && sudo apt install -y /tmp/vscode.deb && rm /tmp/vscode.deb)
        description: Installing VS Code...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: '[ -x ~/.local/bin/claude ] || curl -fsSL https://claude.ai/install.sh | bash'
        description: Installing Claude Code CLI...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: command -v aws >/dev/null 2>&1 || (curl -fsSL "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o /tmp/awscliv2.zip && unzip -q /tmp/awscliv2.zip -d /tmp && sudo /tmp/aws/install && rm -rf /tmp/awscliv2.zip /tmp/aws)
        description: Installing AWS CLI...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: command -v gh >/dev/null 2>&1 || ((type -p wget >/dev/null || (sudo apt update && sudo apt install wget -y)) && sudo mkdir -p -m 755 /etc/apt/keyrings && out=$(mktemp) && wget -nv -O$out https://cli.github.com/packages/githubcli-archive-keyring.gpg && cat $out | sudo tee /etc/apt/keyrings/githubcli-archive-keyring.gpg > /dev/null && sudo chmod go+r /etc/apt/keyrings/githubcli-archive-keyring.gpg && echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null && sudo apt update && sudo apt install gh -y)
        description: Installing GitHub CLI...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: command -v kubectl >/dev/null 2>&1 || (KUBE_VERSION=$(curl -fsSL https://dl.k8s.io/release/stable.txt | sed 's/\.[0-9]*$//') && sudo mkdir -p -m 755 /etc/apt/keyrings && curl -fsSL "https://pkgs.k8s.io/core:/stable:/${KUBE_VERSION}/deb/Release.key" | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg && sudo chmod 644 /etc/apt/keyrings/kubernetes-apt-keyring.gpg && echo "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/${KUBE_VERSION}/deb/ /" | sudo tee /etc/apt/sources.list.d/kubernetes.list > /dev/null && sudo chmod 644 /etc/apt/sources.list.d/kubernetes.list && sudo apt-get update && sudo apt-get install -y kubectl)
        description: Installing kubectl...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: 'installed=$(code --list-extensions 2>/dev/null); while read ext; do echo "$installed" | grep -qiF "$ext" || code --install-extension "$ext"; done < .vscode/extensions.txt'
        description: Installing VSCode extensions...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: ./install-iosevka.sh
        description: Installing Iosevka font...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: gsettings set org.gnome.desktop.input-sources xkb-options "['ctrl:swap_lalt_lctl', 'caps:escape']"
        description: Configuring keyboard (swap left ctrl/alt, caps lock to escape)...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: ./install-swap.sh
        description: Configuring swap (32GB, swappiness=10)...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
    -
        command: |
            if [ "$SHELL" != "$(which zsh)" ]; then
                sudo chsh -s "$(which zsh)" "$USER"
                echo ""
                echo "=========================================="
                echo "Default shell changed to zsh."
                echo "Please log out and back in for the change to take effect."
                echo "=========================================="
            fi
        description: Setting zsh as default shell...
        quiet: false
        stdin: true
        stdout: true
        stderr: true
